
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>RVM: Escaping Gem Dependency Hell - Stewart Gleadow's Blog</title>
  <meta name="author" content="Stewart Gleadow">

  
  <meta name="description" content="This is my second post on my move to rvm. The first being about cleaning out my existing gems for a fresh start. Bundler seemed like it was the ideal &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.stewgleadow.com/blog/2011/03/27/rvm-escaping-gem-dependency-hell">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Stewart Gleadow's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Stewart Gleadow's Blog</a></h1>
  
    <h2>My ramblings about iOS and other software topics.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.stewgleadow.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul role=main-navigation>
  <li><a href="/about.html">About</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/talks.html">Talks</a></li>
  <li><a href="https://github.com/sgleadow">Code</a></li>
  <li><a href="http://twitter.com/stewgleadow">Twitter</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">RVM: Escaping Gem Dependency Hell</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-03-27T16:02:00+11:00" pubdate data-updated="true">Mar 27<span>th</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>This is my second post on my move to rvm. The first being about <a href="blog/2011/03/27/cleaning-out-ruby-gems-under-os-x/">cleaning out my existing gems</a> for a fresh start.</p>

<p>Bundler seemed like it was the ideal solution to having specific gems for specific projects, but it seems to install in your system gems by default causing version and dependency conflicts with other projects I&rsquo;m working on. I know I can use <code>bundle --deployment</code> but then I have to <code>bundle exec</code> everything and I don&rsquo;t have enough Ruby-fu to use the bundler-managed gems within Rakefile etc.</p>

<p>I&rsquo;m looking to <a href="http://rvm.beginrescueend.com/">rvm</a> to solve the problem. The steps I followed are below:</p>

<h2>Installing RVM</h2>

<p>There are some pretty good <a href="http://rvm.beginrescueend.com/rvm/install/">installation instructions</a> on the rvm site. The actual installation is a just single command.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>bash &lt; &lt;<span class="o">(</span>curl -B http://rvm.beginrescueend.com/install/rvm<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>You&rsquo;ll see a bunch of output, and towards the bottom, a confirmation message saying &ldquo;Installation of RVM to /Users/sgleadow/.rvm/ is complete.&rdquo;, but that&rsquo;s not all. You need to set up your shell to know about rvm. Put the following line into your .bash_profile or wherever your chosen shell wants it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[[</span> -s <span class="s2">&quot;$HOME/.rvm/scripts/rvm&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> . <span class="s2">&quot;$HOME/.rvm/scripts/rvm&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>After that, source your profile and check rvm is present and accessible.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">source</span> ~/.bash_profile
</span><span class='line'><span class="nv">$ </span>which rvm/Users/sgleadow/.rvm/bin/rvm
</span><span class='line'>/Users/sgleadow/.rvm/bin/rvm
</span><span class='line'><span class="nv">$ </span>rvm --version
</span><span class='line'>rvm 1.5.2 by Wayne E. Seguin <span class="o">(</span>wayneeseguin@gmail.com<span class="o">)</span> <span class="o">[</span>http://rvm.beginrescueend.com/<span class="o">]</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">type </span>rvm | head -1
</span><span class='line'>rvm is a <span class="k">function</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Installing some Rubies</h2>

<p>Now that rvm is installed, let&rsquo;s install some rubies to use with it. First, check which ruby versions are available.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>rvm list known
</span><span class='line'>...
</span><span class='line'><span class="o">[</span>ruby-<span class="o">]</span>1.8.7<span class="o">[</span>-p334<span class="o">]</span>
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ll install the main two versions that I&rsquo;m using at the moment. Each install will take a few minutes, so this is a good time to make a cup of tea. I would usually say coffee but I haven&rsquo;t bought any fresh coffee beans in a while and the stuff I has is so old that the coffee tastes like sawdust.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>rvm install 1.8.7
</span><span class='line'><span class="nv">$ </span>rvm install 1.9.2
</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;m still using 1.8.7 for some things at the moment, so I&rsquo;ll set that up as the default, and double check that the active ruby binary is now the one I just installed using rvm.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>rvm --default use 1.8.7
</span><span class='line'><span class="nv">$ </span>ruby -v
</span><span class='line'>ruby 1.8.7 <span class="o">(</span>2011-02-18 patchlevel 334<span class="o">)</span> <span class="o">[</span>i686-darwin10.7.0<span class="o">]</span>
</span><span class='line'><span class="nv">$ </span>which ruby
</span><span class='line'>/Users/sgleadow/.rvm/rubies/ruby-1.8.7-p334/bin/ruby
</span><span class='line'><span class="nv">$ </span>which gem
</span><span class='line'>/Users/sgleadow/.rvm/rubies/ruby-1.8.7-p334/bin/gem
</span><span class='line'><span class="nv">$ </span>rvm list default
</span><span class='line'>Default Ruby <span class="o">(</span><span class="k">for </span>new shells<span class="o">)</span>
</span><span class='line'>ruby-1.8.7-p334 <span class="o">[</span> x86_64 <span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Done. We have rvm up and running</p>

<h2>Setting up your gemsets</h2>

<p>While rvm solves the issue of having multiple versions of ruby installed on the one machine, and switching between them, it also allows you to set up multiple gemsets, which is the feature that started me on this journey in the first place. I&rsquo;d like to set up a separate gemset for each separate project to try and keep them separate and escape from dependency hell.</p>

<p>I should have a pretty clean slate to start on for my gems. I&rsquo;m not 100% on whether rvm will use my old system gems or not, but I&rsquo;ve cleaned them all out anyway, so it shouldn&rsquo;t be a problem.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>gem list
</span><span class='line'>*** LOCAL GEMS ***
</span><span class='line'>rake <span class="o">(</span>0.8.7<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span>rvm list gemsets
</span><span class='line'>rvm <span class="nv">gemsets</span>
</span><span class='line'><span class="o">=</span>&gt; ruby-1.8.7-head <span class="o">[</span> x86_64 <span class="o">]</span>
</span><span class='line'>   ruby-1.8.7-head@global <span class="o">[</span> x86_64 <span class="o">]</span>
</span><span class='line'>   ruby-1.9.2-head <span class="o">[</span> x86_64 <span class="o">]</span>
</span><span class='line'>   ruby-1.9.2-head@global <span class="o">[</span> x86_64 <span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>rvm will set up a default gemset for you, but I&rsquo;d like to have each project automatically set its own ruby version and gemset. We can use the .rvmrc file to achieve this. I&rsquo;m setting a project up that uses the <a href="https://github.com/moredip/Frank">Frank</a> iOS testing tool, below is a sample of the .rvmrc file I have <em>inside</em> that my project root directory. When I enter that directory in the shell, rvm picks up the rc file and will switch to that version of ruby (the part before the @) and also switch to a specific gemset (the part after the @). The <code>--create</code> means that if the gemset does not already exist, create one. The first time you enter the directory, you will need to specifically allow rvm to do this. After that, it&rsquo;s automatic.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat my_project/.rvmrc
</span><span class='line'>rvm --create use ruby-1.8.7-p334@frank
</span></code></pre></td></tr></table></div></figure>


<p>Once the .rvmrc file is created, leave and return to the directory to kick it off, authorise it and you should see something like <code>Using /Users/sgleadow/.rvm/gems/ruby-1.8.7-p334 with gemset frank</code> printed to the console. To double check we are, in fact, using the newly created gemset, use <code>rvm list gemsets</code> or <code>rvm gemset list</code> and check the little hashrocket is pointing to the new gemset. Do another <code>gem list</code> to double check you have a clean slate.</p>

<p>Most of my projects use bundler, so first I&rsquo;ll need to install that, then I can use bundler to manage all the gems I need installed. Before using bundler, I wanted to remove the existing gems that had been used by bundler.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>rm .bundle/config
</span><span class='line'><span class="nv">$ </span>rm -r vendor/bundle
</span><span class='line'><span class="nv">$ </span>gem install bundler
</span><span class='line'><span class="nv">$ </span>bundle
</span></code></pre></td></tr></table></div></figure>


<p>Bundler should install all the gems listed in the Gemfile into the gemset you have just defined for this project. Once bundle is complete, check the gems were installed in the gemset and not just in vendor with <code>gem list</code>. If you&rsquo;re project is all set up with a Rakefile to run your tests, try that to double check everything has gone smoothly.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Stewart Gleadow</span></span>

      








  


<time datetime="2011-03-27T16:02:00+11:00" pubdate data-updated="true">Mar 27<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/frank/'>frank</a>, <a class='category' href='/blog/categories/osx/'>osx</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>, <a class='category' href='/blog/categories/rvm/'>rvm</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.stewgleadow.com/blog/2011/03/27/rvm-escaping-gem-dependency-hell/" data-via="stewgleadow" data-counturl="http://www.stewgleadow.com/blog/2011/03/27/rvm-escaping-gem-dependency-hell/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/03/27/cleaning-out-ruby-gems-under-os-x/" title="Previous Post: Cleaning Out Ruby Gems Under OS X">&laquo; Cleaning Out Ruby Gems Under OS X</a>
      
      
        <a class="basic-alignment right" href="/blog/2011/04/19/xcode-4-shortcuts-lightning-talk/" title="Next Post: Xcode 4 Shortcuts Lightning Talk">Xcode 4 Shortcuts Lightning Talk &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/07/02/getting-started-with-ios-development/">Getting Started With iOS Development</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/05/18/tolerant-json-parsing-for-ios/">Tolerant JSON Parsing for iOS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/03/installing-imagemagick-on-lion/">Installing ImageMagick on Lion</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/02/09/running-ocunit-and-kiwi-tests-on-the-command-line/">Running OCUnit &amp; Kiwi Tests on the Command Line</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/12/10/installing-rvm-on-os-x-lion/">Installing RVM on OS X Lion</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/sgleadow">@sgleadow</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'sgleadow',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Stewart Gleadow -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sgleadow-blog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.stewgleadow.com/blog/2011/03/27/rvm-escaping-gem-dependency-hell/';
        var disqus_url = 'http://www.stewgleadow.com/blog/2011/03/27/rvm-escaping-gem-dependency-hell/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
